author: rastreator
name: domain_admins_and_sessions
state: enabled
tactic: discovery
tag: issue
description: Get Domain Administrators and their active sessions.
statement:
  main: >-
    match (c:Computer{enabled:true, domain:'RAS-DOMAIN'})-[:HasSession]->(u:User{enabled:true, domain:'RAS-DOMAIN'})-[:MemberOf*1..]->(:Group{name:'RAS-DA@RAS-DOMAIN'})
    return distinct u.name, c.name
    order by u.name, c.name asc
  count:
    - return .* order/return u.name, count(u.name) as sessions order
    - order .*/order by sessions desc, u.name asc
nextsteps:
  rt:
    - Compromise them.
    - Steal user passwords and hashes.
    - Become a domain administrator.
  bt:
    - Ensure Domain Administrators only logon to secured systems.
