author: rastreator
name: users_same_timestamp_password
state: enabled
tactic: credential access
tag: attack
description: Get number of user passwords set at the same time (maybe same password)
sentence:
  table: >-
    match (u:User{enabled:true})
    where not u.pwdlastset = 0.0
    with u.pwdlastset as ts, count(u.pwdlastset) as cts
    where cts > 5
    return datetime({epochSeconds:toInteger(RAS-TIMESTAMP(ts))}), ts, cts
    order by cts desc
nextsteps:
  rt:
    - Compromise them.
    - Check if those users share the same password or hash.
  bt:
    - Discover why passwords are set at the same time.
    - Check if passwords have the same hash.
