author: rastreator
name: non-highvalue_objects_reach_da
state: enabled
tactic: privilege escalation
tag: issue
description: Get non-highvalue objects that reach Domain Admins.
sentence:
  table: >-
    match p=(n)-[:MemberOf*1..]->(g:Group{highvalue:true})
    with nodes(p) as np
    unwind np as unp
    with collect(distinct unp) as dunp
    match (n), (g:Group)
    where not n in dunp and (n:Group or n.enabled = true) and g.name in ['RAS-DA@RAS-DOMAIN', 'RAS-EA@RAS-DOMAIN', 'RAS-A@RAS-DOMAIN']
    with n, g
    match p=allShortestPaths((n)-[r:MemberOf|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|Contains|GpLink*1..]->(g))
    return distinct n.name
    order by n.name
  graph:
    - return .*/return p
nextsteps:
  rt:
    - Compromise them.
    - Become a domain administrator.
  bt:
    - Check security descriptors.
